{% extends 'base.html' %}

{% block title %}药品库存 - 医药ERP系统{% endblock %}

{% block extra_css %}
<style>
    .inline-actions {
        display: flex;
        gap: 0.5rem;
        align-items: center;
    }
    .link-btn {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 500;
    }
    .link-btn:hover { color: #1d4ed8; }
</style>
{% endblock %}

{% block content %}
<div class="breadcrumb">
    <a href="{% url 'index' %}">工作台</a> / 药品库存
</div>

<div class="page-header">
    <h1 class="page-title">药品库存列表</h1>
    <div class="inline-actions">
        <a class="link-btn" href="{% url 'medicine_info_list' %}"><i class="fa-solid fa-pills"></i> 药品信息</a>
        {% if perms.base.add_inventory %}
        <a class="link-btn" href="{% url 'inventory_create' %}"><i class="fa-solid fa-plus"></i> 新增库存批次</a>
        {% endif %}
    </div>
</div>

<div class="data-table-wrapper">
    <table class="data-table">
        <thead>
            <tr>
                <th>药品名称</th>
                <th>规格</th>
                <th>生产厂家</th>
                <th>批号</th>
                <th>有效期</th>
                <th>库存数量</th>
                <th>指导售价</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            {% for item in inventory_items %}
            <tr>
                <td>{{ item.medicine.common_name }}</td>
                <td>{{ item.medicine.specification }}</td>
                <td>{{ item.medicine.manufacturer }}</td>
                <td>{{ item.batch_number }}</td>
                <td>
                    {{ item.expiry_date|date:"Y-m-d" }}
                    {% if item.is_expiring_soon %}
                    <span class="status-badge status-warning">临期</span>
                    {% endif %}
                </td>
                <td>
                    {{ item.quantity }}
                    {% if item.quantity < 10 %}
                    <span class="status-badge status-danger">缺货</span>
                    {% endif %}
                </td>
                <td>¥{{ item.medicine.sell_price }}</td>
                <td>
                    {% if perms.base.change_inventory %}
                    <a class="link-btn" href="{% url 'inventory_adjust' pk=item.id %}"><i class="fa-solid fa-rotate"></i> 调整库存</a>
                    &nbsp;|&nbsp;
                    <a class="link-btn" href="{% url 'inventory_edit' pk=item.id %}"><i class="fa-solid fa-pen-to-square"></i> 编辑库存</a>
                    {% else %}
                    <span style="color:#94a3b8;">无权限</span>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="8" style="text-align: center; color: #64748b; padding: 2rem;">
                    暂无库存记录
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
